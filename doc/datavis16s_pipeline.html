{% extends &quot;base.html&quot; %}

{% block content %}
<div style="padding: 20px 30px 20px 30px">
<h1>16S Visualization Pipeline</h1>
<h2 id="ampvis2-and-plotly">ampvis2 and Plotly</h2>
<p>Nephele uses the <a href="https://madsalbertsen.github.io/ampvis2/">ampvis2 R package</a> v2.3.2 for statistical computation. We also make use of the <a href="https://plot.ly/r/">Plotly R interface</a> for the <a href="https://plot.ly">plotly.js</a> charting library. The plots can be minimally edited interactively. However, they also have a link to export the data to the <a href="https://plot.ly/online-chart-maker/">Plotly Chart Studio</a> which allows for <a href="https://help.plot.ly/tutorials/">making a variety of charts</a>.</p>
<h2 id="plots">Plots</h2>
<h3 id="rarefaction-curve">Rarefaction Curve</h3>
<p>The rarefaction curves are made with the <a href="https://madsalbertsen.github.io/ampvis2/reference/amp_rarecurve.html">amp_rarecurve</a> function. The table is written to <em>rarecurve.txt</em> and the plot to <em>rarecurve.html</em>.</p>
<pre class="r"><code>rarecurve &lt;- amp_rarecurve(amp, color_by = &quot;TreatmentGroup&quot;)</code></pre>
<h3 id="pcoa">PCoA</h3>
<p>Principal coordinates analysis using binomial and Bray-Curtis distances is carried out using <a href="https://madsalbertsen.github.io/ampvis2/reference/amp_ordinate.html">amp_ordinate</a>. Samples which fall below the specified sampling depth are removed from the OTU table using <a href="https://madsalbertsen.github.io/ampvis2/reference/amp_subset_samples.html">amp_subset_samples</a> before the distance measures are computed. The binomial distance is able to handle varying sample sizes. However, for the Bray-Curtis PCoA, the OTU table is rarefied to the sampling depth using <a href="https://www.rdocumentation.org/packages/vegan/versions/2.4-2/topics/rarefy">rrarefy</a> from the vegan R package. At least 3 samples are needed in the OTU table for the plot to be generated. The tables are written to <em>pcoa_binomial.txt</em> and <em>pcoa_bray.txt</em> and the plots to <em>pcoa_binomial.html</em> and <em>pcoa_bray.html</em>.</p>
<pre class="r"><code>amp &lt;- amp_subset_samples(amp, minreads = sampdepth)
pcoa_binomial &lt;- amp_ordinate(amp, filter_species = 0.01, type = &quot;PCOA&quot;, distmeasure = &quot;binomial&quot;, 
    sample_color_by = &quot;TreatmentGroup&quot;, detailed_output = TRUE, transform = &quot;none&quot;)
otu &lt;- rrarefy(t(amp$abund), sampdepth)
amp$abund &lt;- t(otu)
pcoa_bray &lt;- amp_ordinate(amp, filter_species = 0.01, type = &quot;PCOA&quot;, distmeasure = &quot;bray&quot;, 
    sample_color_by = &quot;TreatmentGroup&quot;, detailed_output = TRUE, transform = &quot;none&quot;)</code></pre>
<h3 id="alpha-diversity">Alpha diversity</h3>
<p>The Shannon diversity and Chao species richness are computed using <a href="https://madsalbertsen.github.io/ampvis2/reference/amp_alphadiv.html">amp_alphadiv</a>. Samples which fall below the specified sampling depth are removed, and the OTU table is rarefied to the sampling depth before the diversity computation. The table is written to <em>alphadiv.txt</em>, and boxplots are output to <em>alphadiv.html</em>. At least 3 samples are needed to produce these plots.</p>
<pre class="r"><code>alphadiv &lt;- amp_alphadiv(amp, measure = &quot;shannon&quot;, richness = TRUE, rarefy = sampdepth)</code></pre>
<h3 id="heatmap">Heatmap</h3>
<p>The interactive heatmap is implemented using the <a href="https://github.com/cmap/morpheus.R">morpheus R API</a> developed at the Broad Institute. A <a href="https://software.broadinstitute.org/morpheus/tutorial.html">tutorial</a> for how to use the heatmap can be found on the <a href="https://software.broadinstitute.org/morpheus/">morpheus website</a>.</p>
<p>The OTU table is first normalized to represent the relative abundances using amp_subset_samples before the heatmap is made with morpheus. In order for the heatmap to be generated, the OTU table must be at least 2x2. The heatmaps are made from the raw OTU table (<em>seq_heatmap.html</em>) and also at the family level (<em>Family_heatmap.html</em>).</p>
<pre class="r"><code>amp &lt;- amp_subset_samples(amp, normalise = TRUE)
heatmap &lt;- morpheus(amptax$abund, colorScheme = list(scalingMode = &quot;fixed&quot;, values = values, 
    colors = colors, stepped = FALSE), columnAnnotations = amptax$metadata[, tg:desc])</code></pre>
<h2 id="tools-and-references">Tools and References</h2>
<p>
M A, SM K, AS Z, RH K and PH N (2015). "Back to Basics - The Influence of DNA Extraction and Primer Choice on Phylogenetic Analysis of Activated Sludge Communities." <em>PLoS ONE</em>, <b>10</b>(7), pp. e0132783. <a href="http://dx.plos.org/10.1371/journal.pone.0132783">http://dx.plos.org/10.1371/journal.pone.0132783</a>.
</p>
<pre><code>## Warning in citation(&quot;morpheus&quot;): no date field in DESCRIPTION file of
## package 'morpheus'</code></pre>
<pre><code>## Warning in citation(&quot;morpheus&quot;): could not determine year for 'morpheus'
## from package DESCRIPTION file</code></pre>
<p>
person) (????). <em>morpheus: Interactive heat maps using 'morpheus.js' and 'htmlwidgets'</em>. R package version 0.1.1.1, <a href="https://github.com/cmap/morpheus.R">https://github.com/cmap/morpheus.R</a>.
</p>
<p>
Sievert C, Parmer C, Hocking T, Chamberlain S, Ram K, Corvellec M and Despouy P (2017). <em>plotly: Create Interactive Web Graphics via 'plotly.js'</em>. R package version 4.7.1, <a href="https://CRAN.R-project.org/package=plotly">https://CRAN.R-project.org/package=plotly</a>.
</p>
<p>
McMurdie PJ and Paulson JN (2016). <em>biomformat: An interface package for the BIOM file format</em>. <a href="https://github.com/joey711/biomformat/">https://github.com/joey711/biomformat/</a>.
</p>
</div>
{% endblock %}
